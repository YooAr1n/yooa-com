"use strict";(self["webpackChunkyooa_com"]=self["webpackChunkyooa_com"]||[]).push([[827],{8827:function(t,e,a){a.r(e);a(8111),a(116),a(7588);var n=a(1051),r=a(8802),o=a(5792),s=a(5151),i=a(1612);function l(t="YooAIncrementalAPI"){try{const e=i.A?.aws_cloud_logic_custom;if(Array.isArray(e)){const a=e.find(e=>e&&(e.name===t||e.apiName===t));if(a)return a.endpoint||a.url||null}const a=i.A?.API?.endpoints||i.A?.api?.endpoints;if(Array.isArray(a)){const e=a.find(e=>e&&(e.name===t||e.apiName===t));if(e)return e.endpoint||e.url||null}}catch(e){}return"https://z4frjlkbjb.execute-api.us-east-1.amazonaws.com/dev"}async function c(t,e,a=null){if(s.API&&"function"===typeof s.API.post)try{return await s.API.post("YooAIncrementalAPI",t,{body:e,headers:a?{Authorization:`Bearer ${a}`}:void 0})}catch(c){console.warn("Amplify API.post failed, falling back to fetch():",c)}const n=l("YooAIncrementalAPI")||"https://z4frjlkbjb.execute-api.us-east-1.amazonaws.com/dev",r=(n.endsWith("/")?n.slice(0,-1):n)+(t.startsWith("/")?t:"/"+t),o={"Content-Type":"application/json"};a&&(o["Authorization"]=`Bearer ${a}`);const i=await fetch(r,{method:"POST",headers:o,body:JSON.stringify(e)});if(!i.ok){const t=await i.text().catch(()=>"");throw new Error(`Fetch POST ${i.status} ${i.statusText} ${t}`)}try{return await i.json()}catch(c){return null}}class u{async savePlayerData(t,e={},a="main"){try{let i=null;try{i=await(0,r.H)().catch(()=>null)}catch(s){i=null}if(!i)return console.warn("savePlayerData: no authenticated user"),!1;let l=null;try{const t=await(0,n.$)();l=t?.tokens?.idToken?.toString?.()||t?.tokens?.idToken?.jwtToken||null}catch(s){l=i?.signInUserSession?.idToken?.jwtToken??null}const u={slot:a,scoreRaw:String(t??0)};let d,f=null;if(e&&"object"===typeof e&&("string"===typeof e.displayName&&""!==e.displayName.trim()&&(f=e.displayName),"string"===typeof e.avatarKey&&""!==e.avatarKey.trim()?d=e.avatarKey:"string"===typeof e.avatarUrl&&""!==e.avatarUrl.trim()&&(d=e.avatarUrl)),!f||"undefined"===typeof d)try{const t=await(0,o.T)().catch(()=>null),e={};if(Array.isArray(t)?t.forEach(t=>{const a=t.Name||t.name,n=t.Value||t.value;a&&(e[a]=n)}):t&&"object"===typeof t&&Object.assign(e,t),f||(f=e["custom:displayName"]||e["name"]||e["email"]||i?.username||null),"undefined"===typeof d){const t=e["custom:picture"]||e["picture"]||null;t&&(d=t)}}catch(s){console.warn("savePlayerData: fetchUserAttributes failed",s)}f&&(u.displayName=String(f)),d&&(u.avatarKey=String(d));const y=await c("/leaderboard/update",u,l);return console.log("leaderboard update response:",y),!0}catch(i){return console.error("Failed to save to leaderboard:",i),!1}}async getTopPlayers(t=100){try{if(s.API&&"function"===typeof s.API.get){const e=await s.API.get("YooAIncrementalAPI","/leaderboard/top",{queryStringParameters:{limit:String(t)}});return e&&e.items?e.items:[]}{const e=l("YooAIncrementalAPI"),a=(e.endsWith("/")?e.slice(0,-1):e)+"/leaderboard/top?limit="+encodeURIComponent(String(t)),n=await fetch(a);if(!n.ok)throw new Error("GET failed "+n.status);const r=await n.json();return r&&r.items?r.items:[]}}catch(e){return console.error("Failed to get leaderboard:",e),[]}}async getUserRank(t=null){try{if(!t){let a=null;try{a=await(0,r.H)().catch(()=>null)}catch(e){a=null}t=a?.attributes?.sub||a?.username}if(!t)return null;if(s.API&&"function"===typeof s.API.get){const e=await s.API.get("YooAIncrementalAPI","/leaderboard/rank",{queryStringParameters:{userId:t}});return e}{const e=l("YooAIncrementalAPI"),a=(e.endsWith("/")?e.slice(0,-1):e)+"/leaderboard/rank?userId="+encodeURIComponent(String(t)),n=await fetch(a);if(!n.ok)throw new Error("GET failed "+n.status);return await n.json()}}catch(a){return console.error("Failed to get user rank:",a),null}}}e["default"]=new u}}]);
//# sourceMappingURL=827.7deffc06.js.map